{
  "server_host": "10.66.66.1",
  "bridge_port": 8765,
  "shared_secret": "talimy-bridge-shared-secret-v1",
  "branch": "main",
  "server_mode": "runtime_inspector",
  "server_workdir": "",
  "laptop_repo_path": "C:/Users/isfan/Desktop/talimy",
  "tasks_file": "docReja/Reja.md",
  "poll_interval_seconds": 5,
  "request_timeout_seconds": 15,
  "github_ci": {
    "enabled": true,
    "repo": "1sfandyor/Talimy",
    "timeout_seconds": 3600,
    "poll_interval_seconds": 10,
    "workflows": ["CI", "CD API", "CD Web", "CD Platform"],
    "no_run_grace_seconds": 30,
    "require_runs": false
  },
  "telegram": {
    "enabled": "${TELEGRAM_ENABLED}",
    "bot_token": "${TELEGRAM_BOT_TOKEN}",
    "chat_id": "${TELEGRAM_CHAT_ID}"
  },
  "dokploy": {
    "enabled": "${DOKPLOY_ENABLED}",
    "deploy_hook_url": "${DOKPLOY_DEPLOY_HOOK_URL}",
    "hooks": {
      "api": "${DOKPLOY_API_HOOK_URL}",
      "web": "${DOKPLOY_WEB_HOOK_URL}",
      "platform": "${DOKPLOY_PLATFORM_HOOK_URL}",
      "default": "${DOKPLOY_DEPLOY_HOOK_URL}"
    },
    "task_deploy_mapping": {
      "2.x": ["api"],
      "3.x": ["web", "platform"],
      "4.x": ["web", "platform"],
      "5.x": ["web", "platform"],
      "6.x": ["web", "platform"],
      "7.x": ["web", "platform"],
      "8.x": ["web", "platform"],
      "9.x": ["web", "platform"],
      "10.x": ["web", "platform"],
      "11.x": ["web", "platform"],
      "12.x": ["web", "platform"],
      "17.x": ["api", "web", "platform"]
    },
    "auth_header_name": "${DOKPLOY_AUTH_HEADER_NAME}",
    "auth_header_value": "${DOKPLOY_AUTH_HEADER_VALUE}",
    "request_timeout_seconds": 20
  },
  "runtime_checks": {
    "enabled": true,
    "timeout_seconds": 300,
    "poll_interval_seconds": 5,
    "request_timeout_seconds": 15,
    "urls": [
      { "name": "api-health", "url": "https://api.talimy.space/api/health", "expect_status": 200 },
      { "name": "web", "url": "https://talimy.space", "expect_status": 200 },
      { "name": "platform", "url": "https://platform.talimy.space", "expect_status": 200 }
    ]
  },
  "pre_push_mapping": {
    "2.x": "api_prepush"
  },
  "pre_push_checks": {
    "api_prepush": ["bun run lint --filter=api", "bun run typecheck --filter=api"]
  },
  "post_deploy_smoke_mapping": {
    "2.11": "grades_feature_smoke",
    "2.12": "exams_feature_smoke",
    "2.14": "schedule_feature_smoke"
  },
  "post_deploy_smoke_checks": {
    "grades_feature_smoke": [
      "curl.exe -fsS {{BASE_URL}}/api/health | Out-Null",
      "curl.exe -fsS \"{{BASE_URL}}/api/grades?tenantId={{TENANT_ID}}&page=1&limit=10\" -H \"Authorization: Bearer {{ACCESS_TOKEN}}\" | Out-Null",
      "curl.exe -fsS \"{{BASE_URL}}/api/grades/report?tenantId={{TENANT_ID}}\" -H \"Authorization: Bearer {{ACCESS_TOKEN}}\" | Out-Null",
      "curl.exe -fsS \"{{BASE_URL}}/api/grades/scales?tenantId={{TENANT_ID}}\" -H \"Authorization: Bearer {{ACCESS_TOKEN}}\" | Out-Null"
    ],
    "exams_feature_smoke": [
      "curl.exe -fsS {{BASE_URL}}/api/health | Out-Null",
      "curl.exe -fsS \"{{BASE_URL}}/api/exams?tenantId={{TENANT_ID}}&page=1&limit=10\" -H \"Authorization: Bearer {{ACCESS_TOKEN}}\" | Out-Null"
    ],
    "schedule_feature_smoke": [
      "curl.exe -fsS {{BASE_URL}}/api/health | Out-Null",
      "powershell -NoProfile -Command \"$raw = curl.exe -sS -H 'Authorization: Bearer {{ACCESS_TOKEN}}' '{{BASE_URL}}/api/schedule?tenantId={{TENANT_ID}}&page=1&limit=5'; $j = $raw | ConvertFrom-Json; if (-not $j.success) { $body = $raw; if ($body.Length -gt 400) { $body = $body.Substring(0,400) }; throw ('Schedule list success=false | body: ' + $body) }\"",
      "powershell -NoProfile -Command \"$raw = curl.exe -sS -H 'Authorization: Bearer {{ACCESS_TOKEN}}' '{{BASE_URL}}/api/schedule?tenantId={{TENANT_ID}}&dayOfWeek=monday&page=1&limit=5'; $j = $raw | ConvertFrom-Json; if (-not $j.success) { $body = $raw; if ($body.Length -gt 400) { $body = $body.Substring(0,400) }; throw ('Schedule day filter success=false | body: ' + $body) }\"",
      "powershell -NoProfile -Command \"$rawList = curl.exe -sS -H 'Authorization: Bearer {{ACCESS_TOKEN}}' '{{BASE_URL}}/api/schedule?tenantId={{TENANT_ID}}&page=1&limit=1'; $list = $rawList | ConvertFrom-Json; $rows = @(); if ($list.data -is [array]) { $rows = @($list.data) } elseif ($list.data -and $list.data.items) { $rows = @($list.data.items) }; if ($rows.Count -gt 0 -and $rows[0].id) { $rawItem = curl.exe -sS -H 'Authorization: Bearer {{ACCESS_TOKEN}}' ('{{BASE_URL}}/api/schedule/' + $rows[0].id + '?tenantId={{TENANT_ID}}'); $item = $rawItem | ConvertFrom-Json; if (-not $item.success) { $body = $rawItem; if ($body.Length -gt 400) { $body = $body.Substring(0,400) }; throw ('Schedule get-by-id success=false | body: ' + $body) } }\""
    ]
  },
  "smoke_auth": {
    "base_url": "https://api.talimy.space",
    "register_path": "/api/auth/register",
    "tenant_id": "${BRIDGE_SMOKE_TENANT_ID}",
    "email_prefix": "bridge-smoke",
    "full_name": "Bridge Smoke Admin",
    "password": "Password123"
  },
  "task_smoke_policy": {
    "require_explicit_for_numbered_tasks": true,
    "subtask_verifier_enabled": true,
    "subtask_verifier_min_present": 1,
    "subtask_verifier_min_ratio": 0.5
  },
  "dynamic_smoke": {
    "enabled": true,
    "max_commands": 8,
    "codex_timeout_seconds": 600
  },
  "auto_fix": {
    "enabled": true,
    "max_retries": 2,
    "codex_timeout_seconds": 900
  },
  "reja_auto_mark": {
    "enabled": true,
    "date_override": ""
  },
  "session_context": {
    "enabled": true,
    "session_id": "019c86a6-24f6-76f1-b071-373c3d75b356",
    "sessions_root": "C:/Users/isfan/.codex/sessions",
    "max_messages": 12,
    "max_chars": 4000,
    "roles": ["user", "assistant"]
  },
  "server_codex": {
    "enabled": true,
    "binary": "codex",
    "timeout_seconds": 300
  },
  "task_check_mapping": {
    "2.x": "api_runtime",
    "3.x": "web_runtime",
    "4.x": "web_runtime",
    "5.x": "web_runtime",
    "6.x": "web_runtime",
    "7.x": "web_runtime",
    "8.x": "web_runtime",
    "9.x": "web_runtime",
    "10.x": "web_runtime",
    "11.x": "web_runtime",
    "12.x": "web_runtime",
    "16.x": "deploy_runtime",
    "17.x": "deploy_runtime"
  },
  "service_name_patterns": {
    "api": ["talimy-api-"],
    "web": ["talimy-web-"],
    "platform": ["talimy-platform-"]
  },
  "server_checks": {
    "default": ["docker service ls"],
    "deploy_runtime": [
      "docker service ls",
      "docker ps --format \"table {{.Names}}\\t{{.Status}}\\t{{.Ports}}\""
    ],
    "api_runtime": [
      "docker service ps {{service:api}} --no-trunc",
      "docker service logs --tail=200 {{service:api}}",
      "curl -fsS https://api.talimy.space/api/health"
    ],
    "web_runtime": [
      "docker service ps {{service:web}} --no-trunc",
      "docker service logs --tail=200 {{service:web}}",
      "docker service ps {{service:platform}} --no-trunc",
      "docker service logs --tail=200 {{service:platform}}",
      "curl -fsS https://talimy.space > /dev/null",
      "curl -fsS https://platform.talimy.space > /dev/null"
    ]
  }
}

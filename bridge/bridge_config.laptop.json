{
  "server_host": "10.66.66.1",
  "bridge_port": 8765,
  "shared_secret": "talimy-bridge-shared-secret-v1",
  "branch": "main",
  "server_mode": "runtime_inspector",
  "server_workdir": "",
  "config_meta": {
    "config_path_env": "C:/Users/isfan/Desktop/talimy/bridge/bridge_config.laptop.json",
    "repo_path_wsl": "/mnt/c/Users/isfan/Desktop/talimy",
    "repo_path_windows": "C:/Users/isfan/Desktop/talimy",
    "notes": "Optional helper env placeholders for documentation/ops. bridge_client currently reads BRIDGE_CONFIG_PATH directly; repo path uses laptop_repo_path and is WSL-normalized automatically."
  },
  "laptop_repo_path": "C:/Users/isfan/Desktop/talimy",
  "tasks_file": "docReja/Reja.md",
  "poll_interval_seconds": 5,
  "request_timeout_seconds": 15,
  "github_ci": {
    "enabled": true,
    "repo": "1sfandyor/Talimy",
    "timeout_seconds": 3600,
    "poll_interval_seconds": 10,
    "workflows": ["CI", "CD API", "CD Web", "CD Platform"],
    "no_run_grace_seconds": 30,
    "require_runs": false
  },
  "telegram": {
    "enabled": true,
    "bot_token": "8750824317:AAH463QkpPpPuHJ-xEQ_uKK65zhj-b1iIDE",
    "chat_id": "352986914"
  },
  "dokploy": {
    "enabled": true,
    "deploy_hook_url": "${DOKPLOY_DEPLOY_HOOK_URL}",
    "hooks": {
      "api": "http://185.157.46.149:3000/api/deploy/nRjs7EqFq5QxtouZQvlKr",
      "web": "http://185.157.46.149:3000/api/deploy/lvzx0Et1S3W8sp8RJL5kV",
      "platform": "http://185.157.46.149:3000/api/deploy/wfMHtKBwmJLhvDpNxjWOF",
      "default": "${DOKPLOY_DEPLOY_HOOK_URL}"
    },
    "task_deploy_mapping": {
      "2.x": ["api"],
      "3.x": ["web", "platform"],
      "4.x": ["web", "platform"],
      "5.x": ["web", "platform"],
      "6.x": ["web", "platform"],
      "7.x": ["web", "platform"],
      "8.x": ["web", "platform"],
      "9.x": ["web", "platform"],
      "10.x": ["web", "platform"],
      "11.x": ["web", "platform"],
      "12.x": ["web", "platform"],
      "17.x": ["api", "web", "platform"]
    },
    "auth_header_name": "${DOKPLOY_AUTH_HEADER_NAME}",
    "auth_header_value": "${DOKPLOY_AUTH_HEADER_VALUE}",
    "request_timeout_seconds": 20,
    "post_deploy_settle_seconds": 20
  },
  "runtime_checks": {
    "enabled": true,
    "timeout_seconds": 300,
    "poll_interval_seconds": 5,
    "request_timeout_seconds": 15,
    "urls": [
      { "name": "api-health", "url": "https://api.talimy.space/api/health", "expect_status": 200 },
      { "name": "web", "url": "https://talimy.space", "expect_status": 200 },
      { "name": "platform", "url": "https://platform.talimy.space", "expect_status": 200 }
    ]
  },
  "pre_push_mapping": {
    "2.x": "api_prepush"
  },
  "pre_push_checks": {
    "api_prepush": ["bun run lint --filter=api", "bun run typecheck --filter=api"]
  },
  "post_deploy_smoke_mapping": {
    "2.11": "grades_feature_smoke",
    "2.12": "exams_feature_smoke",
    "2.14": "schedule_feature_smoke",
    "2.16": "notices_feature_smoke"
  },
  "post_deploy_smoke_checks": {
    "grades_feature_smoke": [
      "curl -fsS {{BASE_URL}}/api/health >/dev/null",
      "curl -fsS -H \"Authorization: Bearer {{ACCESS_TOKEN}}\" \"{{BASE_URL}}/api/grades?tenantId={{TENANT_ID}}&page=1&limit=10\" >/dev/null",
      "curl -fsS -H \"Authorization: Bearer {{ACCESS_TOKEN}}\" \"{{BASE_URL}}/api/grades/report?tenantId={{TENANT_ID}}\" >/dev/null",
      "curl -fsS -H \"Authorization: Bearer {{ACCESS_TOKEN}}\" \"{{BASE_URL}}/api/grades/scales?tenantId={{TENANT_ID}}\" >/dev/null"
    ],
    "exams_feature_smoke": [
      "curl -fsS {{BASE_URL}}/api/health >/dev/null",
      "curl -fsS -H \"Authorization: Bearer {{ACCESS_TOKEN}}\" \"{{BASE_URL}}/api/exams?tenantId={{TENANT_ID}}&page=1&limit=10\" >/dev/null"
    ],
    "schedule_feature_smoke": [
      "curl -fsS {{BASE_URL}}/api/health -o /dev/null -w 'HTTP:%{http_code}\\n'",
      "raw=$(curl -sS -H \"Authorization: Bearer {{ACCESS_TOKEN}}\" \"{{BASE_URL}}/api/schedule?tenantId={{TENANT_ID}}&page=1&limit=5\" -w '\\nHTTP:%{http_code}\\n'); body=$(printf '%s' \"$raw\" | sed '/^HTTP:[0-9][0-9][0-9]$/d'); printf '%s' \"$body\" | python3 -c \"import sys,json; j=json.load(sys.stdin); assert j.get('success') is True, ('Schedule list success=false | body: ' + json.dumps(j)[:400])\"",
      "raw=$(curl -sS -H \"Authorization: Bearer {{ACCESS_TOKEN}}\" \"{{BASE_URL}}/api/schedule?tenantId={{TENANT_ID}}&dayOfWeek=monday&page=1&limit=5\" -w '\\nHTTP:%{http_code}\\n'); body=$(printf '%s' \"$raw\" | sed '/^HTTP:[0-9][0-9][0-9]$/d'); printf '%s' \"$body\" | python3 -c \"import sys,json; j=json.load(sys.stdin); assert j.get('success') is True, ('Schedule day filter success=false | body: ' + json.dumps(j)[:400])\"",
      "raw=$(curl -sS -H \"Authorization: Bearer {{ACCESS_TOKEN}}\" \"{{BASE_URL}}/api/schedule?tenantId={{TENANT_ID}}&page=1&limit=1\" -w '\\nHTTP:%{http_code}\\n'); body=$(printf '%s' \"$raw\" | sed '/^HTTP:[0-9][0-9][0-9]$/d'); sid=$(printf '%s' \"$body\" | python3 -c \"import sys,json; j=json.load(sys.stdin); rows=((j.get('data') or {}).get('items') if isinstance(j.get('data'),dict) else j.get('data')) or []; print((rows[0] or {}).get('id','') if rows else '')\"); if [ -n \"$sid\" ]; then raw2=$(curl -sS -H \"Authorization: Bearer {{ACCESS_TOKEN}}\" \"{{BASE_URL}}/api/schedule/$sid?tenantId={{TENANT_ID}}\" -w '\\nHTTP:%{http_code}\\n'); body2=$(printf '%s' \"$raw2\" | sed '/^HTTP:[0-9][0-9][0-9]$/d'); printf '%s' \"$body2\" | python3 -c \"import sys,json; j=json.load(sys.stdin); assert j.get('success') is True, ('Schedule get-by-id success=false | body: ' + json.dumps(j)[:400])\"; fi"
    ],
    "notices_feature_smoke": [
      "curl -fsS {{BASE_URL}}/api/health >/dev/null",
      "raw=$(curl -sS -X POST \"{{BASE_URL}}/api/notices\" -H \"Authorization: Bearer {{ACCESS_TOKEN}}\" -H 'Content-Type: application/json' --data '{\"tenantId\":\"{{TENANT_ID}}\",\"title\":\"bridge-smoke-notice-a\",\"content\":\"smoke\",\"targetRole\":\"all\"}' -w '\\nHTTP:%{http_code}\\n'); body=$(printf '%s' \"$raw\" | sed '/^HTTP:[0-9][0-9][0-9]$/d'); printf '%s' \"$body\" | python3 -c \"import sys,json; j=json.load(sys.stdin); assert j.get('success') is True, ('Notice create(default priority) failed | body: ' + json.dumps(j)[:500]); d=j.get('data') or {}; print(d.get('id','')); assert d.get('priority')=='medium', ('Expected default priority medium, got %r' % (d.get('priority'),))\" >/tmp/bridge_notice_a_id && test -s /tmp/bridge_notice_a_id",
      "raw=$(curl -sS -X POST \"{{BASE_URL}}/api/notices\" -H \"Authorization: Bearer {{ACCESS_TOKEN}}\" -H 'Content-Type: application/json' --data '{\"tenantId\":\"{{TENANT_ID}}\",\"title\":\"bridge-smoke-notice-b\",\"content\":\"smoke\",\"targetRole\":\"teachers\",\"priority\":\"urgent\"}' -w '\\nHTTP:%{http_code}\\n'); body=$(printf '%s' \"$raw\" | sed '/^HTTP:[0-9][0-9][0-9]$/d'); printf '%s' \"$body\" | python3 -c \"import sys,json; j=json.load(sys.stdin); assert j.get('success') is True, ('Notice create(urgent) failed | body: ' + json.dumps(j)[:500]); d=j.get('data') or {}; print(d.get('id','')); assert d.get('priority')=='urgent', ('Expected priority urgent, got %r' % (d.get('priority'),)); assert d.get('targetRole')=='teachers', ('Expected targetRole teachers, got %r' % (d.get('targetRole'),))\" >/tmp/bridge_notice_b_id && test -s /tmp/bridge_notice_b_id",
      "NIDA=$(cat /tmp/bridge_notice_a_id); NIDB=$(cat /tmp/bridge_notice_b_id); raw=$(curl -sS -H \"Authorization: Bearer {{ACCESS_TOKEN}}\" \"{{BASE_URL}}/api/notices?tenantId={{TENANT_ID}}&targetRole=teachers&priority=urgent&role=teachers&page=1&limit=20\" -w '\\nHTTP:%{http_code}\\n'); body=$(printf '%s' \"$raw\" | sed '/^HTTP:[0-9][0-9][0-9]$/d'); printf '%s' \"$body\" | python3 -c \"import sys,json,os; j=json.load(sys.stdin); assert j.get('success') is True, ('Notices filter list failed | body: ' + json.dumps(j)[:500]); payload=j.get('data') or {}; rows=((payload.get('items') if isinstance(payload,dict) else None) or (payload.get('data') if isinstance(payload,dict) else None) or payload or []); ids={str((r or {}).get('id','')) for r in rows}; assert os.environ['NIDB'] in ids, ('Created urgent teachers notice missing from filtered list')\"",
      "NIDA=$(cat /tmp/bridge_notice_a_id); raw=$(curl -sS -H \"Authorization: Bearer {{ACCESS_TOKEN}}\" \"{{BASE_URL}}/api/notices/$NIDA?tenantId={{TENANT_ID}}\" -w '\\nHTTP:%{http_code}\\n'); body=$(printf '%s' \"$raw\" | sed '/^HTTP:[0-9][0-9][0-9]$/d'); printf '%s' \"$body\" | python3 -c \"import sys,json; j=json.load(sys.stdin); assert j.get('success') is True, ('Notice get-by-id failed | body: ' + json.dumps(j)[:500])\"",
      "NIDA=$(cat /tmp/bridge_notice_a_id); raw=$(curl -sS -X PATCH -H \"Authorization: Bearer {{ACCESS_TOKEN}}\" -H 'Content-Type: application/json' \"{{BASE_URL}}/api/notices/$NIDA?tenantId={{TENANT_ID}}\" --data '{\"targetRole\":\"parents\",\"priority\":\"low\",\"title\":\"bridge-smoke-notice-a-updated\"}' -w '\\nHTTP:%{http_code}\\n'); body=$(printf '%s' \"$raw\" | sed '/^HTTP:[0-9][0-9][0-9]$/d'); printf '%s' \"$body\" | python3 -c \"import sys,json; j=json.load(sys.stdin); assert j.get('success') is True, ('Notice patch(low/parents) failed | body: ' + json.dumps(j)[:500]); d=j.get('data') or {}; assert d.get('targetRole')=='parents'; assert d.get('priority')=='low'\"",
      "NIDB=$(cat /tmp/bridge_notice_b_id); raw=$(curl -sS -X PATCH -H \"Authorization: Bearer {{ACCESS_TOKEN}}\" -H 'Content-Type: application/json' \"{{BASE_URL}}/api/notices/$NIDB?tenantId={{TENANT_ID}}\" --data '{\"targetRole\":\"students\",\"priority\":\"high\"}' -w '\\nHTTP:%{http_code}\\n'); body=$(printf '%s' \"$raw\" | sed '/^HTTP:[0-9][0-9][0-9]$/d'); printf '%s' \"$body\" | python3 -c \"import sys,json; j=json.load(sys.stdin); assert j.get('success') is True, ('Notice patch(high/students) failed | body: ' + json.dumps(j)[:500]); d=j.get('data') or {}; assert d.get('targetRole')=='students'; assert d.get('priority')=='high'\"",
      "curl -fsS -H \"Authorization: Bearer {{ACCESS_TOKEN}}\" \"{{BASE_URL}}/api/notices?tenantId={{TENANT_ID}}&targetRole=parents&page=1&limit=5\" >/dev/null && curl -fsS -H \"Authorization: Bearer {{ACCESS_TOKEN}}\" \"{{BASE_URL}}/api/notices?tenantId={{TENANT_ID}}&targetRole=students&page=1&limit=5\" >/dev/null && curl -fsS -H \"Authorization: Bearer {{ACCESS_TOKEN}}\" \"{{BASE_URL}}/api/notices?tenantId={{TENANT_ID}}&targetRole=teachers&page=1&limit=5\" >/dev/null && curl -fsS -H \"Authorization: Bearer {{ACCESS_TOKEN}}\" \"{{BASE_URL}}/api/notices?tenantId={{TENANT_ID}}&targetRole=all&page=1&limit=5\" >/dev/null",
      "NIDA=$(cat /tmp/bridge_notice_a_id); NIDB=$(cat /tmp/bridge_notice_b_id); raw1=$(curl -sS -X DELETE -H \"Authorization: Bearer {{ACCESS_TOKEN}}\" \"{{BASE_URL}}/api/notices/$NIDA?tenantId={{TENANT_ID}}\" -w '\\nHTTP:%{http_code}\\n'); body1=$(printf '%s' \"$raw1\" | sed '/^HTTP:[0-9][0-9][0-9]$/d'); raw2=$(curl -sS -X DELETE -H \"Authorization: Bearer {{ACCESS_TOKEN}}\" \"{{BASE_URL}}/api/notices/$NIDB?tenantId={{TENANT_ID}}\" -w '\\nHTTP:%{http_code}\\n'); body2=$(printf '%s' \"$raw2\" | sed '/^HTTP:[0-9][0-9][0-9]$/d'); printf '%s' \"$body1\" | python3 -c \"import sys,json; j=json.load(sys.stdin); assert j.get('success') is True, ('Notice delete A failed | body: ' + json.dumps(j)[:500])\" && printf '%s' \"$body2\" | python3 -c \"import sys,json; j=json.load(sys.stdin); assert j.get('success') is True, ('Notice delete B failed | body: ' + json.dumps(j)[:500])\""
    ]
  },
  "smoke_auth": {
    "base_url": "https://api.talimy.space",
    "register_path": "/api/auth/register",
    "tenant_id": "eddbf523-f288-402a-9a16-ef93d27aafc7",
    "tenant_id_fallback": "${BRIDGE_TENANT_ID}",
    "email_prefix": "bridge-smoke",
    "full_name": "Bridge Smoke Admin",
    "password": "Password123"
  },
  "task_smoke_policy": {
    "require_explicit_for_numbered_tasks": true,
    "subtask_verifier_enabled": true,
    "subtask_verifier_min_present": 1,
    "subtask_verifier_min_ratio": 0.5
  },
  "dynamic_smoke": {
    "enabled": true,
    "max_commands": 8,
    "codex_timeout_seconds": 600,
    "ai_labels_enabled": true,
    "ai_label_timeout_seconds": 12
  },
  "auto_fix": {
    "enabled": true,
    "max_retries": 2,
    "codex_timeout_seconds": 900
  },
  "reja_auto_mark": {
    "enabled": true,
    "date_override": ""
  },
  "session_context": {
    "enabled": true,
    "session_id": "019c86a6-24f6-76f1-b071-373c3d75b356",
    "sessions_root": "C:/Users/isfan/.codex/sessions",
    "max_messages": 12,
    "max_chars": 4000,
    "roles": ["user", "assistant"]
  },
  "server_codex": {
    "enabled": true,
    "binary": "codex",
    "timeout_seconds": 300
  }
}
